From 44a7fd44a728be5aaabe5266b55c568ef46c8cc3 Mon Sep 17 00:00:00 2001
From: Sriram Chappidi <Sriram.Chappidi@analog.com>
Date: Fri, 4 Oct 2024 13:21:28 +0530
Subject: [PATCH 17/17] arch: arm64: configs: adi_defconfig: pwm-gpio.c support

Signed-off-by: Sriram Chappidi <Sriram.Chappidi@analog.com>
---
 arch/arm64/configs/adi_defconfig | 1 +
 drivers/pwm/pwm-gpio.c           | 5 +++--
 2 files changed, 4 insertions(+), 2 deletions(-)

diff --git a/arch/arm64/configs/adi_defconfig b/arch/arm64/configs/adi_defconfig
index b439e30f78dc..fc50239b7e7b 100644
--- a/arch/arm64/configs/adi_defconfig
+++ b/arch/arm64/configs/adi_defconfig
@@ -745,6 +745,7 @@ CONFIG_PWM=y
 CONFIG_PWM_CROS_EC=m
 CONFIG_PWM_FSL_FTM=m
 CONFIG_PWM_IMX27=y
+CONFIG_PWM_GPIO=m
 CONFIG_PWM_RPCHIP=y
 CONFIG_PWM_SL28CPLD=m
 CONFIG_SL28CPLD_INTC=y
diff --git a/drivers/pwm/pwm-gpio.c b/drivers/pwm/pwm-gpio.c
index 7e9ffcc1c547..619df4a6c1eb 100644
--- a/drivers/pwm/pwm-gpio.c
+++ b/drivers/pwm/pwm-gpio.c
@@ -209,13 +209,14 @@ static int gpio_pwm_remove(struct platform_device *pdev)
 {
 	struct gpio_pwm_chip *gpio_chip;
 	struct gpio_pwm_data *gpio_data;
+	int ret = 0;
 
 	gpio_chip = platform_get_drvdata(pdev);
 	gpio_data = pwm_get_chip_data(&gpio_chip->chip.pwms[0]);
 
 	hrtimer_cancel(&gpio_data->timer);
-
-	return pwmchip_remove(&gpio_chip->chip);
+	pwmchip_remove(&gpio_chip->chip);
+	return ret;
 }
 
 static const struct of_device_id gpio_pwm_of_match[] = {
-- 
2.28.0

