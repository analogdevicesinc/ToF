From 1610120df896101c746003d12a93b9e9050ef587 Mon Sep 17 00:00:00 2001
From: tzhang2 <tong.zhang@analog.com>
Date: Mon, 18 Mar 2024 09:56:34 +0800
Subject: [PATCH 1/2] arch-arm64-dts-ADI-TOF-dt

---
 .../boot/dts/overlays/adsd3500-overlay.dts    | 82 +++++++++++++++++++
 arch/arm/configs/adi_bcm2711_defconfig        |  1 +
 arch/arm64/configs/bcm2711_defconfig          |  1 +
 3 files changed, 84 insertions(+)
 create mode 100644 arch/arm/boot/dts/overlays/adsd3500-overlay.dts

diff --git a/arch/arm/boot/dts/overlays/adsd3500-overlay.dts b/arch/arm/boot/dts/overlays/adsd3500-overlay.dts
new file mode 100644
index 000000000000..3826dcfa376f
--- /dev/null
+++ b/arch/arm/boot/dts/overlays/adsd3500-overlay.dts
@@ -0,0 +1,82 @@
+// SPDX-License-Identifier: GPL-2.0-only
+/*
+*  Definitions for ADSD3500 TOF module on VC I2C bus
+*/ 
+/dts-v1/;
+/plugin/;
+
+#include <dt-bindings/gpio/gpio.h>
+
+/{
+	compatible = "brcm,bcm2835";
+
+	fragment@0 {
+		target = <&i2c_csi_dsi>;
+		__overlay__ {
+			#address-cells = <1>;
+			#size-cells = <0>;
+			status = "okay";
+
+			adsd3500: adsd3500@38 {
+				compatible = "adi,adsd3500";
+				reg = <0x38>;
+				status = "okay";
+				reset-gpios = <&expgpio 5 GPIO_ACTIVE_LOW>;
+				port {
+					adsd3500_ep: endpoint {
+						remote-endpoint = <&csi1_ep>;
+						clock-lanes = <0>;
+						data-lanes = <1 2>;
+						link-frequencies =
+							/bits/ 64 <732000000>;
+					};
+				};
+			};
+		};
+	};
+
+	fragment@1 {
+		target = <&csi1>;
+		__overlay__ {
+			status = "okay";
+
+			port {
+				csi1_ep: endpoint {
+					remote-endpoint = <&adsd3500_ep>;
+					clock-lanes = <0>;
+					data-lanes = <1 2>;
+				};
+			};
+		};
+	};
+
+	fragment@2 {
+		target = <&i2c0if>;
+		__overlay__ {
+			status = "okay";
+		};
+	};
+
+	fragment@3 {
+		target-path="/";
+		__overlay__ {
+			
+		};
+	};
+
+	fragment@4 {
+		target = <&i2c0mux>;
+		__overlay__ {
+			status = "okay";
+		};
+	};
+
+	fragment@5 {
+		__overlay__ {
+			status = "okay";
+		};
+	};
+
+	__overrides__ {
+	};
+};
diff --git a/arch/arm/configs/adi_bcm2711_defconfig b/arch/arm/configs/adi_bcm2711_defconfig
index 0d0d95be1724..3f23fe11c007 100644
--- a/arch/arm/configs/adi_bcm2711_defconfig
+++ b/arch/arm/configs/adi_bcm2711_defconfig
@@ -920,6 +920,7 @@ CONFIG_VIDEO_TW2804=m
 CONFIG_VIDEO_TW9903=m
 CONFIG_VIDEO_TW9906=m
 CONFIG_VIDEO_IMX219=m
+CONFIG_VIDEO_ADSD3500=m
 CONFIG_VIDEO_IMX290=m
 CONFIG_VIDEO_IMX477=m
 CONFIG_VIDEO_IMX519=m
diff --git a/arch/arm64/configs/bcm2711_defconfig b/arch/arm64/configs/bcm2711_defconfig
index aae05dfcaaf3..144d6657e5ed 100644
--- a/arch/arm64/configs/bcm2711_defconfig
+++ b/arch/arm64/configs/bcm2711_defconfig
@@ -939,6 +939,7 @@ CONFIG_VIDEO_TW2804=m
 CONFIG_VIDEO_TW9903=m
 CONFIG_VIDEO_TW9906=m
 CONFIG_VIDEO_IMX219=m
+CONFIG_VIDEO_ADSD3500=m
 CONFIG_VIDEO_IMX290=m
 CONFIG_VIDEO_IMX477=m
 CONFIG_VIDEO_IMX519=m
-- 
2.34.1

