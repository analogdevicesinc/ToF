import { newE2EPage } from '@stencil/core/testing';
describe('hmc-dropdown', () => {
  let page;
  let button;
  describe('when used in a form', () => {
    it('should submit the form with a single selection', async () => {
      page = await newE2EPage();
      await page.setContent(`
        <form>
          <hmc-dropdown name="dropdown-name" value="input-value">
            <hmc-dropdown-option value="input-value">Val</hmc-dropdown-option>
            <hmc-dropdown-option value="other-value">Other</hmc-dropdown-option>
          </hmc-dropdown>
          <button type="submit">Submit</button>
        </form>
      `);
      button = await page.find('button');
      const form = await page.find('form');
      const spy = await form.spyOnEvent('formdata');
      let x;
      await page.exposeFunction('onSubmitForm', a => {
        x = a;
      });
      page.evaluate(() => {
        const f = document.querySelector('form');
        f.addEventListener('formdata', e => 
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore.
        window.onSubmitForm(e.formData.get('dropdown-name')));
      });
      await page.waitForChanges();
      await button.click();
      expect(spy).toHaveReceivedEvent();
      expect(x).toBe('Val');
    });
  });
});
