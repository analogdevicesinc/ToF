import { newE2EPage } from '@stencil/core/testing';
describe('hmc-radio-group and hmc-radio-button in FormData', () => {
  let page;
  let button;
  it('should submit the form with the selected radio button value', async () => {
    page = await newE2EPage();
    await page.setContent(`
        <form id="test-form">
            <hmc-radio-group name="radio-group" value="three">
                <hmc-radio-button value="one"></hmc-radio-button>
                <hmc-radio-button value="two"></hmc-radio-button>
                <hmc-radio-button value="three"></hmc-radio-button>
                <hmc-radio-button value="five"></hmc-radio-button>
            </hmc-radio-group>
            <button type="submit">Submit</button>
        </form>
    `);
    button = await page.find('button');
    const form = await page.find('form');
    const spy = await form.spyOnEvent('formdata');
    let x;
    await page.exposeFunction('onSubmitForm', a => {
      x = a;
    });
    page.evaluate(() => {
      const f = document.querySelector('form');
      f.addEventListener('formdata', e => 
      // eslint-disable-next-line @typescript-eslint/ban-ts-comment
      // @ts-ignore.
      window.onSubmitForm(e.formData.get('radio-group')));
    });
    let hiddenInput = await page.find('input[type="hidden"][name="radio-group"]');
    expect(hiddenInput).not.toBeNull();
    expect(await hiddenInput.getProperty('value')).toBe('three');
    const radioButton = await page.find('hmc-radio-button[value="two"]');
    await radioButton.click();
    await page.waitForChanges();
    hiddenInput = await page.find('input[type="hidden"][name="radio-group"]');
    expect(await hiddenInput.getProperty('value')).toBe('two');
    await button.click();
    expect(spy).toHaveReceivedEvent();
    expect(x).toBe('two');
  });
});
