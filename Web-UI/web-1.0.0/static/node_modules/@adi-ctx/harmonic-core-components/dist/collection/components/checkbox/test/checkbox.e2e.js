import { newE2EPage } from '@stencil/core/testing';
describe('hmc-checkbox in FormData', () => {
  let page;
  let button;
  it('should submit the form with the selected checkbox value', async () => {
    page = await newE2EPage();
    await page.setContent(`
        <form id="test-form">
            <hmc-checkbox
                name="checkbox1"
                value="value1"
                label="Checkbox 1"
            >
            </hmc-checkbox>
            <button type="submit">Submit</button>
        </form>
    `);
    button = await page.find('button');
    const form = await page.find('form');
    const spy = await form.spyOnEvent('formdata');
    let x;
    await page.exposeFunction('onSubmitForm', a => {
      x = a;
    });
    page.evaluate(() => {
      const f = document.querySelector('form');
      f.addEventListener('formdata', e => {
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore.
        window.onSubmitForm(e.formData.get('checkbox1'));
      });
    });
    const checkbox = await page.find('hmc-checkbox[value="value1"]');
    await checkbox.click();
    await page.waitForChanges();
    await page.evaluate(() => document.querySelector('form').submit());
    expect(spy).toHaveReceivedEvent();
    expect(x).toBe('value1');
  });
});
