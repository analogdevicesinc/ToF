import { newE2EPage } from '@stencil/core/testing';
describe('hmc-textarea', () => {
  let page;
  let button;
  describe('when used in a form', () => {
    it('should submit the form', async () => {
      page = await newE2EPage();
      await page.setContent(`
        <form>
          <hmc-textarea type="text" name="input-name" value="input-value"></hmc-textarea>
          <button type="submit">Submit</button>
        </form>
      `);
      button = await page.find('button');
      const form = await page.find('form');
      const spy = await form.spyOnEvent('formdata');
      let x;
      await page.exposeFunction('onSubmitForm', a => {
        x = a;
      });
      page.evaluate(() => {
        const f = document.querySelector('form');
        f.addEventListener('formdata', e => 
        // eslint-disable-next-line @typescript-eslint/ban-ts-comment
        // @ts-ignore.
        window.onSubmitForm(e.formData.get('input-name')));
      });
      await page.waitForChanges();
      await button.click();
      expect(spy).toHaveReceivedEvent();
      expect(x).toBe('input-value');
    });
  });
});
